---
sidebar_position: 1
title: Store
---

[API Reference](/api-reference/modelence/server/classes/../../../index) / [modelence](/api-reference/modelence/server/classes/../../index) / [server](/api-reference/modelence/server/classes/../index) / Store

Defined in: [packages/modelence/src/data/store.ts:194](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L194)

The Store class provides a type-safe interface for MongoDB collections with built-in schema validation and helper methods.

## Example

```ts
const dbTodos = new Store('todos', {
  schema: {
    title: schema.string(),
    completed: schema.boolean(),
    dueDate: schema.date().optional(),
    userId: schema.userId(),
  },
  methods: {
    isOverdue() {
      return this.dueDate < new Date();
    }
  }
});
```

## Type Parameters

| Type Parameter | Description |
| ------ | ------ |
| `TSchema` *extends* `ModelSchema` | The document schema type |
| `TMethods` *extends* `Record`\<`string`, (`this`, ...`args`) => `any`\> | Custom methods that will be added to documents |

## Constructors

### Constructor

> **new Store**\<`TSchema`, `TMethods`\>(`name`, `options`): `Store`\<`TSchema`, `TMethods`\>

Defined in: [packages/modelence/src/data/store.ts:225](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L225)

Creates a new Store instance

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `name` | `string` | The collection name in MongoDB |
| `options` | \{ `indexes`: `IndexDescription`[]; `methods?`: `TMethods`; `schema`: `TSchema`; `searchIndexes?`: `SearchIndexDescription`[]; \} | Store configuration |
| `options.indexes` | `IndexDescription`[] | MongoDB indexes to create |
| `options.methods?` | `TMethods` | Custom methods to add to documents |
| `options.schema` | `TSchema` | Document schema using Modelence schema types |
| `options.searchIndexes?` | `SearchIndexDescription`[] | MongoDB Atlas Search |

#### Returns

`Store`\<`TSchema`, `TMethods`\>

## Properties

| Property | Modifier | Type | Defined in |
| ------ | ------ | ------ | ------ |
| <a id="doc"></a> `Doc` | `readonly` | `EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods` | [packages/modelence/src/data/store.ts:209](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L209) |

## Methods

### aggregate()

> **aggregate**(`pipeline`, `options?`): `AggregationCursor`\<`Document`\>

Defined in: [packages/modelence/src/data/store.ts:658](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L658)

Aggregates documents using MongoDB's aggregation framework

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `pipeline` | `Document`[] | The aggregation pipeline |
| `options?` | `AggregateOptions` | Optional options |

#### Returns

`AggregationCursor`\<`Document`\>

The aggregation cursor

***

### bulkWrite()

> **bulkWrite**(`operations`): `Promise`\<`BulkWriteResult`\>

Defined in: [packages/modelence/src/data/store.ts:668](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L668)

Performs a bulk write operation on the collection

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `operations` | `AnyBulkWriteOperation`\<`InferDocumentType`\<`TSchema`\>\>[] | The operations to perform |

#### Returns

`Promise`\<`BulkWriteResult`\>

The result of the bulk write operation

***

### countDocuments()

> **countDocuments**(`query`): `Promise`\<`number`\>

Defined in: [packages/modelence/src/data/store.ts:523](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L523)

Counts the number of documents that match a query

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `query` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The query to filter documents |

#### Returns

`Promise`\<`number`\>

The number of documents that match the query

***

### deleteMany()

> **deleteMany**(`selector`): `Promise`\<`DeleteResult`\>

Defined in: [packages/modelence/src/data/store.ts:647](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L647)

Deletes multiple documents

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `selector` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The selector to find the documents to delete |

#### Returns

`Promise`\<`DeleteResult`\>

The result of the delete operation

***

### deleteOne()

> **deleteOne**(`selector`): `Promise`\<`DeleteResult`\>

Defined in: [packages/modelence/src/data/store.ts:637](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L637)

Deletes a single document

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `selector` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The selector to find the document to delete |

#### Returns

`Promise`\<`DeleteResult`\>

The result of the delete operation

***

### extend()

> **extend**\<`TExtendedSchema`, `TExtendedMethods`\>(`config`): `Store`\<`TSchema` & `TExtendedSchema`, `PreserveMethodsForExtendedSchema`\<`TMethods`, `TSchema` & `TExtendedSchema`\> & `TExtendedMethods`\>

Defined in: [packages/modelence/src/data/store.ts:292](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L292)

Extends the store with additional schema fields, indexes, methods, and search indexes.
Returns a new Store instance with the extended schema and updated types.
Methods from the original store are preserved with updated type signatures.

#### Example

```ts
// Extend the users collection
export const dbUsers = baseUsersCollection.extend({
  schema: {
    firstName: schema.string(),
    lastName: schema.string(),
    companyId: schema.objectId().optional(),
  },
  indexes: [
    { key: { companyId: 1 } },
    { key: { lastName: 1, firstName: 1 } },
  ],
  methods: {
    getFullName() {
      return `${this.firstName} ${this.lastName}`;
    }
  }
});

// Now fully typed with new fields
const user = await dbUsers.findOne({ firstName: 'John' });
console.log(user?.getFullName());
```

#### Type Parameters

| Type Parameter | Default type |
| ------ | ------ |
| `TExtendedSchema` *extends* `ModelSchema` | - |
| `TExtendedMethods` *extends* `Record`\<`string`, (`this`, ...`args`) => `any`\> | `Record`\<`string`, `never`\> |

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `config` | \{ `indexes?`: `IndexDescription`[]; `methods?`: `TExtendedMethods`; `schema?`: `TExtendedSchema`; `searchIndexes?`: `SearchIndexDescription`[]; \} | Additional schema fields, indexes, methods, and search indexes to add |
| `config.indexes?` | `IndexDescription`[] | - |
| `config.methods?` | `TExtendedMethods` | - |
| `config.schema?` | `TExtendedSchema` | - |
| `config.searchIndexes?` | `SearchIndexDescription`[] | - |

#### Returns

`Store`\<`TSchema` & `TExtendedSchema`, `PreserveMethodsForExtendedSchema`\<`TMethods`, `TSchema` & `TExtendedSchema`\> & `TExtendedMethods`\>

A new Store instance with the extended schema

***

### fetch()

> **fetch**(`query`, `options?`): `Promise`\<`EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`[]\>

Defined in: [packages/modelence/src/data/store.ts:534](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L534)

Fetches multiple documents, equivalent to Node.js MongoDB driver's `find` and `toArray` methods combined.

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `query` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The query to filter documents |
| `options?` | \{ `limit?`: `number`; `skip?`: `number`; `sort?`: `Document`; \} | Options |
| `options.limit?` | `number` | - |
| `options.skip?` | `number` | - |
| `options.sort?` | `Document` | - |

#### Returns

`Promise`\<`EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`[]\>

The documents

***

### findById()

> **findById**(`id`): `Promise`\<`null` \| `EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

Defined in: [packages/modelence/src/data/store.ts:495](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L495)

Fetches a single document by its ID

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `id` | `string` \| `ObjectId` | The ID of the document to find |

#### Returns

`Promise`\<`null` \| `EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

The document, or null if not found

***

### findOne()

> **findOne**(`query`, `options?`): `Promise`\<`null` \| `EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

Defined in: [packages/modelence/src/data/store.ts:452](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L452)

Finds a single document matching the query

#### Example

```ts
// ✅ Valid queries:
await store.findOne({ name: 'John' })
await store.findOne({ age: { $gt: 18 } })
await store.findOne({ _id: new ObjectId('...') })
await store.findOne({ tags: { $in: ['typescript', 'mongodb'] } })
await store.findOne({ $or: [{ name: 'John' }, { name: 'Jane' }] })
await store.findOne({ 'emails.address': 'test@example.com' }) // dot notation

// ❌ TypeScript error - 'id' is not in schema:
await store.findOne({ id: '123' })
```

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `query` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | Type-safe query filter. Only schema fields, MongoDB operators, and dot notation are allowed. |
| `options?` | `FindOptions`\<`Document`\> | Find options |

#### Returns

`Promise`\<`null` \| `EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

The document, or null if not found

***

### getDatabase()

> **getDatabase**(): `Db`

Defined in: [packages/modelence/src/data/store.ts:677](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L677)

Returns the raw MongoDB database instance for advanced operations

#### Returns

`Db`

The MongoDB database instance

#### Throws

Error if the store is not provisioned

***

### getName()

> **getName**(): `string`

Defined in: [packages/modelence/src/data/store.ts:245](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L245)

#### Returns

`string`

***

### insertMany()

> **insertMany**(`documents`): `Promise`\<`InsertManyResult`\<`Document`\>\>

Defined in: [packages/modelence/src/data/store.ts:560](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L560)

Inserts multiple documents

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `documents` | `OptionalUnlessRequiredId`\<`InferDocumentType`\<`TSchema`\>\>[] | The documents to insert |

#### Returns

`Promise`\<`InsertManyResult`\<`Document`\>\>

The result of the insert operation

***

### insertOne()

> **insertOne**(`document`): `Promise`\<`InsertOneResult`\<`Document`\>\>

Defined in: [packages/modelence/src/data/store.ts:548](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L548)

Inserts a single document

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `document` | `OptionalUnlessRequiredId`\<`InferDocumentType`\<`TSchema`\>\> | The document to insert |

#### Returns

`Promise`\<`InsertOneResult`\<`Document`\>\>

The result of the insert operation

***

### rawCollection()

> **rawCollection**(): `Collection`\<`InferDocumentType`\<`TSchema`\>\>

Defined in: [packages/modelence/src/data/store.ts:686](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L686)

Returns the raw MongoDB collection instance for advanced operations

#### Returns

`Collection`\<`InferDocumentType`\<`TSchema`\>\>

The MongoDB collection instance

#### Throws

Error if the store is not provisioned

***

### renameFrom()

> **renameFrom**(`oldName`, `options?`): `Promise`\<`void`\>

Defined in: [packages/modelence/src/data/store.ts:695](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L695)

Renames an existing collection to this store's name, used for migrations

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `oldName` | `string` | The previous name of the collection |
| `options?` | \{ `session?`: `ClientSession`; \} | - |
| `options.session?` | `ClientSession` | - |

#### Returns

`Promise`\<`void`\>

#### Throws

Error if the old collection doesn't exist or if this store's collection already exists

***

### requireById()

> **requireById**(`id`, `errorHandler?`): `Promise`\<`EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

Defined in: [packages/modelence/src/data/store.ts:507](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L507)

Fetches a single document by its ID, or throws an error if not found

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `id` | `string` \| `ObjectId` | The ID of the document to find |
| `errorHandler?` | () => `Error` | Optional error handler to return a custom error if the document is not found |

#### Returns

`Promise`\<`EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

The document

***

### requireOne()

> **requireOne**(`query`, `options?`, `errorHandler?`): `Promise`\<`EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

Defined in: [packages/modelence/src/data/store.ts:460](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L460)

#### Parameters

| Parameter | Type |
| ------ | ------ |
| `query` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> |
| `options?` | `FindOptions`\<`Document`\> |
| `errorHandler?` | () => `Error` |

#### Returns

`Promise`\<`EnhancedOmit`\<`InferDocumentType`\<`TSchema`\>, `"_id"`\> & `object` & `TMethods`\>

***

### updateMany()

> **updateMany**(`selector`, `update`, `options?`): `Promise`\<`UpdateResult`\<`Document`\>\>

Defined in: [packages/modelence/src/data/store.ts:603](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L603)

Updates multiple documents

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `selector` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The selector to find the documents to update |
| `update` | `UpdateFilter`\<`InferDocumentType`\<`TSchema`\>\> | The MongoDB modifier to apply to the documents |
| `options?` | \{ `session?`: `ClientSession`; \} | - |
| `options.session?` | `ClientSession` | - |

#### Returns

`Promise`\<`UpdateResult`\<`Document`\>\>

The result of the update operation

***

### updateOne()

> **updateOne**(`selector`, `update`): `Promise`\<`UpdateResult`\<`Document`\>\>

Defined in: [packages/modelence/src/data/store.ts:573](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L573)

Updates a single document

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `selector` | `string` \| `ObjectId` \| `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The selector to find the document to update |
| `update` | `UpdateFilter`\<`InferDocumentType`\<`TSchema`\>\> | The update to apply to the document |

#### Returns

`Promise`\<`UpdateResult`\<`Document`\>\>

The result of the update operation

***

### upsertMany()

> **upsertMany**(`selector`, `update`): `Promise`\<`UpdateResult`\<`Document`\>\>

Defined in: [packages/modelence/src/data/store.ts:622](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L622)

Updates multiple documents, or inserts them if they don't exist

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `selector` | `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The selector to find the documents to update |
| `update` | `UpdateFilter`\<`InferDocumentType`\<`TSchema`\>\> | The MongoDB modifier to apply to the documents |

#### Returns

`Promise`\<`UpdateResult`\<`Document`\>\>

The result of the update operation

***

### upsertOne()

> **upsertOne**(`selector`, `update`): `Promise`\<`UpdateResult`\<`Document`\>\>

Defined in: [packages/modelence/src/data/store.ts:587](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L587)

Updates a single document, or inserts it if it doesn't exist

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `selector` | `string` \| `ObjectId` \| `TypedFilter`\<`InferDocumentType`\<`TSchema`\>\> | The selector to find the document to update |
| `update` | `UpdateFilter`\<`InferDocumentType`\<`TSchema`\>\> | The MongoDB modifier to apply to the document |

#### Returns

`Promise`\<`UpdateResult`\<`Document`\>\>

The result of the update operation

***

### vectorSearch()

> **vectorSearch**(`params`): `Promise`\<`AggregationCursor`\<`Document`\>\>

Defined in: [packages/modelence/src/data/store.ts:740](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L740)

Performs a vector similarity search using MongoDB Atlas Vector Search

#### Example

```ts
const results = await store.vectorSearch({
  field: 'embedding',
  embedding: [0.1, 0.2, 0.3, ...],
  numCandidates: 100,
  limit: 10,
  projection: { title: 1, description: 1 }
});
```

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `params` | \{ `embedding`: `number`[]; `field`: `string`; `indexName?`: `string`; `limit?`: `number`; `numCandidates?`: `number`; `projection?`: `Document`; \} | Vector search parameters |
| `params.embedding` | `number`[] | The query vector to search for |
| `params.field` | `string` | The field name containing the vector embeddings |
| `params.indexName?` | `string` | Name of index (default: field + VectorSearch) |
| `params.limit?` | `number` | Maximum number of results to return (default: 10) |
| `params.numCandidates?` | `number` | Number of nearest neighbors to consider (default: 100) |
| `params.projection?` | `Document` | Additional fields to include in the results |

#### Returns

`Promise`\<`AggregationCursor`\<`Document`\>\>

An aggregation cursor with search results and scores

***

### vectorIndex()

> `static` **vectorIndex**(`params`): `object`

Defined in: [packages/modelence/src/data/store.ts:803](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L803)

Creates a MongoDB Atlas Vector Search index definition

#### Example

```ts
const store = new Store('documents', {
  schema: {
    title: schema.string(),
    embedding: schema.array(schema.number()),
  },
  indexes: [],
  searchIndexes: [
    Store.vectorIndex({
      field: 'embedding',
      dimensions: 1536,
      similarity: 'cosine'
    })
  ]
});
```

#### Parameters

| Parameter | Type | Description |
| ------ | ------ | ------ |
| `params` | \{ `dimensions`: `number`; `field`: `string`; `indexName?`: `string`; `similarity?`: `"cosine"` \| `"euclidean"` \| `"dotProduct"`; \} | Vector index parameters |
| `params.dimensions` | `number` | The number of dimensions in the vector embeddings |
| `params.field` | `string` | The field name to create the vector index on |
| `params.indexName?` | `string` | Name of index (default: field + VectorSearch) |
| `params.similarity?` | `"cosine"` \| `"euclidean"` \| `"dotProduct"` | The similarity metric to use (default: 'cosine') |

#### Returns

`object`

A search index description object

| Name | Type | Default value | Defined in |
| ------ | ------ | ------ | ------ |
| `definition` | `object` | - | [packages/modelence/src/data/store.ts:817](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L817) |
| `definition.fields` | `object`[] | - | [packages/modelence/src/data/store.ts:818](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L818) |
| `name` | `string` | - | [packages/modelence/src/data/store.ts:816](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L816) |
| `type` | `string` | `'vectorSearch'` | [packages/modelence/src/data/store.ts:815](https://github.com/modelence/modelence/blob/a7d1ab8431181b95ae21f698af9c96598f725c25/packages/modelence/src/data/store.ts#L815) |
